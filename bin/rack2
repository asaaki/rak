#!/usr/bin/env ruby

require 'rubygems'
begin
  require 'oniguruma'
  $use_onig = true
rescue
  $use_onig = false
end

require 'rubygems'
require 'inline'

class Rack
  VERSION = "0.0.1"
  
  def self.search(str, dir="")
    re = Oniguruma::ORegexp.new(str)
    p re.instance_variables
    search_with_regexp(re, dir)
  end
  
  def self.search_with_regexp(re, dir="")
    Dir[dir+"*"].each do |fn|
      if File.directory? fn
        search_with_regexp(re, fn+"/")
      else
        File.open(fn) do |f|
          found = false
          f.each_line do |line|
            if line =~ re
                found = true
            end
          end
          puts fn if found
        end
      end
    end
  end
  
  inline do |builder|
    builder.c "
    long factorial_c(int max) {
      int i=max, result=1;
      while (i >= 2) { result *= i--; }
      return result;
    }"
  end
  
  inline do |builder|
    builder.c "
    int match(VALUE re) {
      int found = 10;
      return found;
    }"
  end
end

p /#{ARGV[0]}/

Rack.search ARGV[0]
p Rack.new.factorial_c(6)
p Rack.new.match(5)
